{% extends "base.html" %}

{% load admin_urls %}
{% load url from future %}
{% load michaux %}

{% block title %}{% if query_string %}
   {% with total=sqs|length %}
   {{ total }} oeuvre{{ total|pluralize }} correspondant à "{{ query_string }}"
   {% endwith %}
   {% else %}
   {{ "Liste des oeuvres" }}
   {% endif %}{% endblock %}
{% block extra_header %}
    <link href="{{ STATIC_URL }}css/michaux-grid.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="{{ STATIC_URL }}css/jquery-ui.css" rel="stylesheet" type="text/css" media="screen" />
    <script type="text/javascript" src="{{ STATIC_URL }}js/jquery.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/jquery-ui.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/michaux-grid.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/d3.v2.min.js"></script>
{% endblock %}

{% block header %}<h1>{% with total=sqs|length %}{{ total }} oeuvre{{ total|pluralize }}{% if query_string %} correspondant à "{{ query_string }}"{% endif %}{% endwith %}</h1>
    <div>{% if selected_facets %}| {% for facet in selected_facets %} {{ facet }} |{% endfor %}{% endif %}</div>
{% endblock %}

{% block margin %}
        {% with total=sqs|length %}
        <p>{{ total }} oeuvre{{ total|pluralize }} sélectionnée{{ total|pluralize }}</p>
        {% endwith %}
        <form>
          <label for="filter">Filtre</label>
          <input id="filter" type="text" name="q" value="{{ query_string }}" />
          <a href="javascript:michaux.resetFilter()"><img id="filter_reset_icon" alt="Reset" title="Supprimer le filtre" src="{{ STATIC_URL }}icons/reset.png" /></a>
        </form>

        <p>
          <label for="date">Date de création</label>
          <input type="text" id="date" style="border: 0" />
        </p>
        <div id="slider-range"></div>
        <div id="shown"></div>

        <div class="facets">

          <div class="facetcontrols"><a href="javascript:michaux.openFacets()" title="Ouvrir toutes les facettes" />Ouvrir tout</a> <a href="javascript:michaux.closeFacets()" title="Fermer toutes les facettes">Fermer tout</a>
          </div>

          <div class="facetbox">
            <p class="facettitle">Technique ({{ facets.fields.medium|length }})</p>
            <ul>
            {% for medium in facets.fields.medium|slice:":50" %}
            <li><a href="{{ current_url }}&amp;f=medium_exact:{{ medium.0|urlencode }}">{{ medium.0 }}</a> ({{ medium.1 }})
              {% if medium.0 in selected_facets %}<a href="{{ current_url|url_remove_facet:medium }}" class="active-facet">&nbsp;&nbsp;&nbsp;</a>{% endif %}
            </li>
            {% endfor %}
            </ul>
          </div>

          <div class="facetbox">
            <p class="facettitle">Support ({{ facets.fields.support|length }})</p>
            <ul>
            {% for support in facets.fields.support|slice:":50" %}
            <li><a href="{{ current_url }}&amp;f=support_exact:{{ support.0|urlencode }}">{{ support.0 }}</a> ({{ support.1 }})
              {% if support.0 in selected_facets %}<a href="{{ current_url|url_remove_facet:support }}" class="active-facet">&nbsp;&nbsp;&nbsp;</a>{% endif %}
            </li>
            {% endfor %}
            </ul>
          </div>

          <div class="facetbox">
            <p class="facettitle">Série ({{ facets.fields.serie|length }})</p>
            <ul>
            {% for serie in facets.fields.serie|slice:":50" %}
            <li><a href="{{ current_url }}&amp;f=serie_exact:{{ serie.0|urlencode }}">{{ serie.0 }}</a> ({{ serie.1 }})
              {% if serie.0 in selected_facets %}<a href="{{ current_url|url_remove_facet:serie }}" class="active-facet">&nbsp;&nbsp;&nbsp;</a>{% endif %}
            </li>
            {% endfor %}
            </ul>
          </div>

          <div class="facetbox">
            <p class="facettitle">Création [début]  ({{ facets.fields.creation_date_start|length }})</p>
            <ul>
            {% for date in facets.fields.creation_date_start|slice:":50" %}
            <li><a data-year="{{ date.0 }}" data-count="{{ date.1 }}" href="{{ current_url }}&amp;f=creation_date_start_exact:{{ date.0|urlencode }}">{{ date.0 }}</a> ({{ date.1 }})
              {% if date.0 in selected_facets %}<a href="{{ current_url|url_remove_facet:date }}" class="active-facet">&nbsp;&nbsp;&nbsp;</a>{% endif %}
            </li>
            {% endfor %}
            </ul>
          </div>

          <div class="facetbox">
            <p class="facettitle">Histogramme ({{ facets.fields.creation_date_start|length }})</p>
            <div id="creationHistogram"></div>
          </div>

          <div class="facetbox">
            <p class="facettitle">Tags ({{ facets.fields.tags|length }})</p>
            <ul>
              {% for tag in facets.fields.tags|slice:":50" %}
              <li><a href="{{ current_url }}&amp;f=tags_exact:{{ tag.0|urlencode }}">{{ tag.0 }}</a> ({{ tag.1 }})
                {% if tag.0 in selected_facets %}<a href="{{ current_url|url_remove_facet:tag }}" class="active-facet">&nbsp;&nbsp;&nbsp;</a>{% endif %}
              </li>
              {% endfor %}
            </ul>
          </div>

        </div>

        <div class="tagcloud">
          {% for tag in tagcloud_data %}
          <font size="{{ tag.weight|floatformat:0 }}"><a class="tag" href="?tag={{ tag }}">{{ tag }}</a></font>
          {% endfor %}
        </div>


{% endblock %}

{% block content %}
        {% for res in sqs %}
        {% with work=res.object %}
        {% with thumb=work.thumbnail %}
        <div class="work" data-start="{{ work.creation_date_start }}">
          <a class="vignette" href="{{ work.image.url }}"><img class="{% if thumb.width > thumb.height %}landscape{% else %}portrait{% endif %}"
                                                               alt="" title="{{ work }}"
                                                               src="{% if thumb %}{{ thumb.url }}{% else %}{{ STATIC_URL }}unknown_thumbnail.png{% endif %}"></a>
          <ul class="toolbar"><li><a target="_blank" href="{% url meta|admin_urlname:'change' work.cote %}" class="edit"></a></li><li><a target="_blank" href="{{ work.get_absolute_url }}" class="details"></a></li></ul>
            </div>
        {% endwith %}
        {% endwith %}
        {% endfor %}
      </div>
{% endblock %}
