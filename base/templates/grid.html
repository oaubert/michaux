{% extends "base.html" %}

{% load admin_urls %}
{% load url from future %}
{% load michaux %}

{% block title %} Catalogue raisonné Henri Michaux -
{% with total=sqs|length %}
{% if query_string %}
{{ total }} œuvre{{ total|pluralize }} correspondant à "{{ query_string }}"
{% else %}
{{ total }} œuvre{{ total|pluralize }}
{% endif %}
{% endwith %}
{% endblock %}
{% block extra_header %}
    <link href="{{ STATIC_URL }}css/michaux/grid.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="{{ STATIC_URL }}css/michaux/grid-print.css" rel="stylesheet" type="text/css" media="print" />
    <link href="{{ STATIC_URL }}css/jquery-ui.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="{{ STATIC_URL }}css/tipsy.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="{{ STATIC_URL }}css/jquery.iviewer.css" rel="stylesheet" type="text/css" media="screen" />

    <!-- The admin jquery.js is in the django namespace -->
    <script type="text/javascript" src="/static/admin/js/jquery.min.js"></script>
    <script type="text/javascript" src="/static/admin/js/jquery.init.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/jquery.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/jquery-ui.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/d3.v3.min.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/jquery.tipsy.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/jquery.mousewheel.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/jquery.iviewer.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/michaux/grid.js"></script>

{{ tagform.media }}
{% endblock %}

{% block header %}
<div id="zoom"><div id="zoomslider"></div></div>
{% endblock %}

{% block margin %}
<form id="form_filter" name="form_filter">
  <div class="pagination">
    <span class="step-links">
      <input type="hidden" id="current_page" name="page" value="{{ page.number }}" />
      <a id="previous_page" {% if page.has_previous %}title="Page précédente" onclick="michaux.goto_page({{ page.previous_page_number }})" {% else %}title="Première page" class="disabled"{% endif %}></a>
      <span>Page {{ page.number }} sur {{ page.paginator.num_pages }}</span>
      <a id="next_page" {% if page.has_next %}title="Page suivante" onclick="michaux.goto_page({{ page.next_page_number }})" {% else %}title="Dernière page" class="disabled"{% endif %}></a>
    </span>
  </div>

  <ul>

    <li><input placeholder="Filtre..." id="filter" type="text" name="q" value="{{ options.query_string }}" />
      <a href="javascript:michaux.resetFilter()"><img id="filter_reset_icon" alt="Reset" title="Supprimer le filtre" src="{{ STATIC_URL }}icons/reset.png" /></a></li>
    <li id="selection_menuitem"><input type="hidden" id="selection" name="selection" value="{{ options.selection }}" />{% with selcount=options.selectionset|length %}<a id="selection_menu">{{ selcount }} {% if selcount > 1 %}éléments sélectionnés{% else %}élément sélectionné{% endif %}</a>{% endwith %}

      <ul id="selection_popup">
        <li><a id="selection_compare">Comparer</a></li>
        <li><a id="selection_open">Afficher</a></li>
        <!-- <li><a id="selection_tag">Tagguer</a></li> -->
      </ul>
    </li>

    <li><label for="checkbox_images">Images</label>
      <input onclick="this.form.submit()" id="checkbox_images" type="checkbox" name="with_image" {% if options.with_image %}checked="on"{% endif %} title="Uniquement œuvres avec image"/>
      <label for="checkbox_revision">Révisions</label>
      <input id="checkbox_revision" onclick="this.form.submit()" type="checkbox" name="with_revision" {% if options.with_revision %}checked="on"{% endif %} title="Uniquement œuvres avec champ révision non vide" /></li>

    <li><label for="checkbox_single_technique">Technique</label>
      <input id="checkbox_single_technique" onclick="this.form.submit()" type="checkbox" name="single_technique" {% if options.single_technique %}checked="on"{% endif %} title="Uniquement œuvres avec une seule technique"/></li>

    <li><label for="info_overlay">Overlay</label>
      <select id="info_overlay" name="info_overlay" onchange="this.form.submit()">
        {% for opt in overlay_fields %}
        <option value="{{ opt.0 }}" {% ifequal info_overlay opt.0 %}selected="1"{% endifequal %}>{{ opt.1 }}</option>
        {% endfor %}
      </select>
    </li>
  </ul>

  <div class="facets">

    {% include "textfacet.html" with name="Statut" field="status" %}
    {% include "textfacet.html" with name="Technique" field="technique" %}
    {% include "textfacet.html" with name="Support" field="support" %}
    {% include "textfacet.html" with name="Série" field="serie" %}

    <div class="facetbox barchartbox" data-field="creation_date_start__range">
      <p class="facettitle">Création <span id="histogramRange">{{ range.creation_date_start.creation_date_start__min }} - {{ range.creation_date_start.creation_date_start__max }}</span> <span class="facetcount">{{ facets.fields.creation_date_start|length }}</span>{% if "creation_date_start__range" in selected_facets %}<a class="active-facet"></a><input type="hidden" name="f" value="creation_date_start__range:{{ selected_facets.creation_date_start__range.0 }}" />{% endif %}
</p>
      <div class="facetcontent barchart">
        <div data-min="{{ range.creation_date_start.creation_date_start__min }}" data-max="{{ range.creation_date_start.creation_date_start__max }}" id="creationHistogram">
          {% for h in facets.fields.creation_date_start %}
          <span class="facetdata" data-year="{{ h.0 }}" data-count="{{ h.1 }}"></span>
          {% endfor %}
        </div>
      </div>
    </div>

    <div class="facetbox barchartbox" data-field="height__range">
      <p class="facettitle">Hauteur <span id="heightRange">{{ range.height.height__min }} - {{ range.height.height__max }}</span> <span class="facetcount">{{ facets.fields.height|length }}</span> {% if "height__range" in selected_facets %}<a class="active-facet"></a><input type="hidden" name="f" value="height__range:{{ selected_facets.height__range.0 }}" />{% endif %}
</p>
      <div class="facetcontent barchart">
        <div data-min="{{ range.height.height__min }}" data-max="{{ range.height.height__max }}" id="heightHistogram">
          {% for h in facets.fields.height %}
          <span class="facetdata" data-height="{{ h.0 }}" data-count="{{ h.1 }}"></span>
          {% endfor %}
        </div>
      </div>
    </div>

    <div class="facetbox barchartbox" data-field="width__range">
      <p class="facettitle">Largeur <span id="widthRange">{{ range.width.width__min }} - {{ range.width.width__max }}</span> <span class="facetcount">{{ facets.fields.width|length }}</span> {% if "width__range" in selected_facets %}<a class="active-facet"></a><input type="hidden" name="f" value="width__range:{{ selected_facets.width__range.0 }}" />{% endif %}
</p>
      <div class="facetcontent barchart">
        <div data-min="{{ range.width.width__min }}" data-max="{{ range.width.width__max }}" id="widthHistogram">
          {% for h in facets.fields.width %}
          <span class="facetdata" data-width="{{ h.0 }}" data-count="{{ h.1 }}"></span>
          {% endfor %}
        </div>
      </div>
    </div>

    {% include "textfacet.html" with name="Exposition" field="exhibition" %}

    <div class="facetbox" data-field="tags_exact">
      <p class="facettitle">Tags <span class="facetcount">{{ facets.fields.tags|length }}</span></p>
      <div class="facetcontent">
        <ul>
          {% for tags in facets.fields.tags %}
          <li>{% if tags.0 in selected_facets.tags_exact %}<input type="hidden" name="f" value="tags_exact:{{ tags.0 }}" /><a class="active-facet"></a>{% endif %}<a class="facetitemlabel">{{ tags.0 }}</a> <span class="facetitemcount">{{ tags.1 }}</span>
          </li>
          {% endfor %}
        </ul>
      </div>
    </div>

  </div>

  <div id="filler">
  </div>
</form>

        {% endblock %}

        {% block content %}
        <div id="grid">

          {% for res in page %}
          {% include "griditem.html" with work=res.object info=res.object|getattr:info_overlay %}
          {% endfor %}

        </div>
        <div id="info_panel">
        </div>
        {% endblock %}
